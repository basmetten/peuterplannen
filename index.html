<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Peuterplannen üåü</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #FFFBF5;
    --primary: #6C3CE1;
    --primary-light: #EDE5FF;
    --accent: #FFD93D;
    --success: #6BCB77;
    --pink: #FF6B9D;
    --text: #1A1A2E;
    --text-muted: #6B7280;
    --card: #FFFFFF;
    --radius: 20px;
    --radius-lg: 24px;
    --shadow: 0 4px 20px rgba(0,0,0,0.08);
    --shadow-md: 0 8px 30px rgba(0,0,0,0.12);
    --transition: all 0.2s ease;
  }

  body {
    font-family: 'Nunito', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    padding-bottom: 40px;
  }

  /* Header */
  .app-header {
    background: linear-gradient(135deg, var(--primary) 0%, #8B5CF6 100%);
    color: white;
    padding: 20px 20px 0;
    text-align: center;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 4px 20px rgba(108,60,225,0.3);
  }

  .app-title {
    font-size: 1.6rem;
    font-weight: 900;
    letter-spacing: -0.5px;
    margin-bottom: 4px;
  }

  .app-subtitle {
    font-size: 0.85rem;
    opacity: 0.85;
    font-weight: 500;
    margin-bottom: 16px;
  }

  /* Tabs */
  .tabs {
    display: flex;
    gap: 4px;
    background: rgba(255,255,255,0.15);
    border-radius: 16px 16px 0 0;
    padding: 6px 6px 0;
  }

  .tab-btn {
    flex: 1;
    background: transparent;
    border: none;
    color: rgba(255,255,255,0.7);
    font-family: 'Nunito', sans-serif;
    font-size: 0.85rem;
    font-weight: 700;
    padding: 10px 8px 12px;
    border-radius: 12px 12px 0 0;
    cursor: pointer;
    transition: var(--transition);
    white-space: nowrap;
  }

  .tab-btn.active {
    background: var(--bg);
    color: var(--primary);
  }

  .tab-btn:hover:not(.active) {
    background: rgba(255,255,255,0.1);
    color: white;
  }

  /* Main content */
  .main {
    max-width: 800px;
    margin: 0 auto;
    padding: 24px 16px;
  }

  .tab-panel { display: none; }
  .tab-panel.active { display: block; }

  /* Cards */
  .card {
    background: var(--card);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow);
    padding: 20px;
    margin-bottom: 16px;
  }

  /* Buttons */
  .btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 10px 18px;
    border-radius: 50px;
    border: none;
    font-family: 'Nunito', sans-serif;
    font-weight: 700;
    font-size: 0.9rem;
    cursor: pointer;
    transition: var(--transition);
    min-height: 44px;
  }

  .btn:hover { transform: scale(1.02); }
  .btn:active { transform: scale(0.98); }

  .btn-primary {
    background: var(--primary);
    color: white;
    box-shadow: 0 4px 15px rgba(108,60,225,0.35);
  }

  .btn-primary:hover {
    background: #5a2fd4;
    box-shadow: 0 6px 20px rgba(108,60,225,0.45);
  }

  .btn-accent {
    background: var(--accent);
    color: var(--text);
  }

  .btn-ghost {
    background: var(--primary-light);
    color: var(--primary);
  }

  .btn-sm {
    padding: 6px 12px;
    font-size: 0.8rem;
    min-height: 34px;
  }

  /* Today tab */
  .date-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 24px;
  }

  .date-header h2 {
    font-size: 1.6rem;
    font-weight: 900;
    color: var(--text);
  }

  .date-badge {
    background: var(--primary-light);
    color: var(--primary);
    font-weight: 700;
    font-size: 0.8rem;
    padding: 4px 12px;
    border-radius: 50px;
  }

  .time-block {
    background: var(--card);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow);
    padding: 20px;
    margin-bottom: 16px;
    transition: var(--transition);
  }

  .time-block:hover {
    box-shadow: var(--shadow-md);
  }

  .time-block-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 14px;
  }

  .time-block-title {
    font-size: 1.1rem;
    font-weight: 800;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .time-block-ochtend { border-top: 4px solid #FFD93D; }
  .time-block-middag { border-top: 4px solid #FF6B9D; }
  .time-block-avond { border-top: 4px solid #6C3CE1; }

  .activities-list {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    min-height: 36px;
    margin-bottom: 12px;
  }

  .activity-pill {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: var(--primary-light);
    color: var(--primary);
    border-radius: 50px;
    padding: 6px 12px 6px 10px;
    font-size: 0.85rem;
    font-weight: 700;
    transition: var(--transition);
    animation: popIn 0.2s ease;
  }

  @keyframes popIn {
    from { transform: scale(0.8); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
  }

  .activity-pill .remove-btn {
    background: none;
    border: none;
    cursor: pointer;
    color: var(--primary);
    opacity: 0.6;
    padding: 0;
    font-size: 1rem;
    line-height: 1;
    transition: var(--transition);
    display: flex;
    align-items: center;
  }

  .activity-pill .remove-btn:hover { opacity: 1; color: #e53e3e; }

  .empty-state {
    color: var(--text-muted);
    font-size: 0.85rem;
    font-weight: 600;
    font-style: italic;
    padding: 8px 0;
  }

  /* Week tab */
  .week-nav {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
  }

  .week-nav h2 {
    font-size: 1.2rem;
    font-weight: 800;
  }

  .nav-btn {
    background: var(--card);
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    font-size: 1.1rem;
    cursor: pointer;
    box-shadow: var(--shadow);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
  }

  .nav-btn:hover { transform: scale(1.08); box-shadow: var(--shadow-md); }

  .week-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 8px;
  }

  .day-card {
    background: var(--card);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 10px 8px;
    cursor: pointer;
    transition: var(--transition);
    min-height: 100px;
  }

  .day-card:hover { transform: scale(1.03); box-shadow: var(--shadow-md); }

  .day-card.today {
    background: linear-gradient(135deg, var(--primary), #8B5CF6);
    color: white;
    box-shadow: 0 6px 20px rgba(108,60,225,0.35);
  }

  .day-name {
    font-size: 0.7rem;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    opacity: 0.7;
    margin-bottom: 2px;
  }

  .day-card.today .day-name { opacity: 0.85; color: white; }

  .day-num {
    font-size: 1.3rem;
    font-weight: 900;
    margin-bottom: 6px;
  }

  .day-chip {
    font-size: 0.65rem;
    font-weight: 700;
    background: var(--primary-light);
    color: var(--primary);
    border-radius: 50px;
    padding: 2px 6px;
    display: block;
    margin-bottom: 3px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .day-card.today .day-chip {
    background: rgba(255,255,255,0.25);
    color: white;
  }

  /* Activities library */
  .search-bar {
    position: relative;
    margin-bottom: 16px;
  }

  .search-bar input {
    width: 100%;
    padding: 12px 16px 12px 44px;
    border-radius: 50px;
    border: 2px solid transparent;
    background: var(--card);
    font-family: 'Nunito', sans-serif;
    font-size: 0.95rem;
    font-weight: 600;
    box-shadow: var(--shadow);
    outline: none;
    transition: var(--transition);
  }

  .search-bar input:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 4px var(--primary-light);
  }

  .search-icon {
    position: absolute;
    left: 14px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 1.1rem;
  }

  .filter-chips {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-bottom: 20px;
  }

  .filter-chip {
    background: var(--card);
    border: 2px solid transparent;
    border-radius: 50px;
    padding: 7px 14px;
    font-family: 'Nunito', sans-serif;
    font-size: 0.8rem;
    font-weight: 700;
    cursor: pointer;
    box-shadow: var(--shadow);
    transition: var(--transition);
    white-space: nowrap;
  }

  .filter-chip:hover { transform: scale(1.03); }

  .filter-chip.active {
    background: var(--primary);
    color: white;
    box-shadow: 0 4px 12px rgba(108,60,225,0.3);
  }

  .activities-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
  }

  @media (min-width: 600px) {
    .activities-grid { grid-template-columns: repeat(3, 1fr); }
  }

  .activity-card {
    background: var(--card);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow);
    padding: 16px;
    transition: var(--transition);
    display: flex;
    flex-direction: column;
  }

  .activity-card:hover {
    transform: scale(1.02);
    box-shadow: var(--shadow-md);
  }

  .activity-emoji {
    font-size: 2.4rem;
    margin-bottom: 8px;
    line-height: 1;
  }

  .activity-name {
    font-size: 0.95rem;
    font-weight: 800;
    margin-bottom: 4px;
    color: var(--text);
  }

  .activity-age {
    display: inline-block;
    background: var(--accent);
    color: var(--text);
    font-size: 0.7rem;
    font-weight: 700;
    padding: 2px 8px;
    border-radius: 50px;
    margin-bottom: 6px;
  }

  .activity-desc {
    font-size: 0.78rem;
    color: var(--text-muted);
    font-weight: 600;
    line-height: 1.4;
    flex: 1;
    margin-bottom: 10px;
  }

  /* Modal */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.5);
    backdrop-filter: blur(4px);
    z-index: 1000;
    display: flex;
    align-items: flex-end;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.25s ease;
  }

  .modal-overlay.open {
    opacity: 1;
    pointer-events: all;
  }

  .modal {
    background: var(--bg);
    border-radius: var(--radius-lg) var(--radius-lg) 0 0;
    padding: 24px 20px 40px;
    width: 100%;
    max-width: 600px;
    transform: translateY(100%);
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    max-height: 90vh;
    overflow-y: auto;
  }

  .modal-overlay.open .modal {
    transform: translateY(0);
  }

  .modal-handle {
    width: 40px;
    height: 4px;
    background: #e0e0e0;
    border-radius: 50px;
    margin: 0 auto 20px;
  }

  .modal-title {
    font-size: 1.3rem;
    font-weight: 900;
    margin-bottom: 20px;
    color: var(--text);
  }

  .form-group {
    margin-bottom: 16px;
  }

  .form-label {
    display: block;
    font-size: 0.85rem;
    font-weight: 700;
    color: var(--text-muted);
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .form-input, .form-select {
    width: 100%;
    padding: 12px 16px;
    border-radius: var(--radius);
    border: 2px solid #E5E7EB;
    background: var(--card);
    font-family: 'Nunito', sans-serif;
    font-size: 0.95rem;
    font-weight: 600;
    outline: none;
    transition: var(--transition);
    -webkit-appearance: none;
  }

  .form-input:focus, .form-select:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 4px var(--primary-light);
  }

  .modal-actions {
    display: flex;
    gap: 10px;
    margin-top: 20px;
  }

  .modal-actions .btn { flex: 1; justify-content: center; }

  /* Library quick-add pills */
  .library-pills {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 16px;
  }

  .library-pill {
    background: var(--card);
    border: 2px solid #E5E7EB;
    border-radius: 50px;
    padding: 6px 12px;
    font-family: 'Nunito', sans-serif;
    font-size: 0.82rem;
    font-weight: 700;
    cursor: pointer;
    transition: var(--transition);
  }

  .library-pill:hover {
    border-color: var(--primary);
    background: var(--primary-light);
    color: var(--primary);
  }

  .library-pill.selected {
    border-color: var(--primary);
    background: var(--primary);
    color: white;
  }

  /* Toast */
  .toast {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: var(--text);
    color: white;
    border-radius: 50px;
    padding: 12px 20px;
    font-weight: 700;
    font-size: 0.9rem;
    z-index: 2000;
    transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    white-space: nowrap;
  }

  .toast.show { transform: translateX(-50%) translateY(0); }

  /* Responsive */
  @media (max-width: 480px) {
    .week-grid { grid-template-columns: repeat(7, 1fr); gap: 4px; }
    .day-card { padding: 6px 4px; }
    .day-num { font-size: 1.1rem; }
    .tab-btn { font-size: 0.75rem; padding: 8px 4px 10px; }
    .app-title { font-size: 1.3rem; }
  }

  .no-results {
    text-align: center;
    padding: 40px 20px;
    color: var(--text-muted);
  }
  .no-results .nr-emoji { font-size: 3rem; margin-bottom: 12px; }
  .no-results p { font-weight: 600; }
</style>
</head>
<body>

<header class="app-header">
  <div class="app-title">üåü Peuterplannen</div>
  <div class="app-subtitle">Jouw dagplanner voor kleine avonturiers</div>
  <div class="tabs">
    <button class="tab-btn active" onclick="switchTab('vandaag')">üìÖ Vandaag</button>
    <button class="tab-btn" onclick="switchTab('week')">üóìÔ∏è Week</button>
    <button class="tab-btn" onclick="switchTab('activiteiten')">üé® Activiteiten</button>
  </div>
</header>

<div class="main">

  <!-- TAB: VANDAAG -->
  <div class="tab-panel active" id="tab-vandaag">
    <div class="date-header">
      <h2 id="today-title">Vandaag</h2>
      <span class="date-badge" id="today-badge"></span>
    </div>

    <!-- Ochtend -->
    <div class="time-block time-block-ochtend">
      <div class="time-block-header">
        <div class="time-block-title">üåÖ Ochtend</div>
        <button class="btn btn-ghost btn-sm" onclick="openAddModal('ochtend')">+ Toevoegen</button>
      </div>
      <div class="activities-list" id="list-ochtend"></div>
    </div>

    <!-- Middag -->
    <div class="time-block time-block-middag">
      <div class="time-block-header">
        <div class="time-block-title">‚òÄÔ∏è Middag</div>
        <button class="btn btn-ghost btn-sm" onclick="openAddModal('middag')">+ Toevoegen</button>
      </div>
      <div class="activities-list" id="list-middag"></div>
    </div>

    <!-- Avond -->
    <div class="time-block time-block-avond">
      <div class="time-block-header">
        <div class="time-block-title">üåô Avond</div>
        <button class="btn btn-ghost btn-sm" onclick="openAddModal('avond')">+ Toevoegen</button>
      </div>
      <div class="activities-list" id="list-avond"></div>
    </div>
  </div>

  <!-- TAB: WEEK -->
  <div class="tab-panel" id="tab-week">
    <div class="week-nav">
      <button class="nav-btn" onclick="changeWeek(-1)">&#9664;</button>
      <h2 id="week-label">Deze week</h2>
      <button class="nav-btn" onclick="changeWeek(1)">&#9654;</button>
    </div>
    <div class="week-grid" id="week-grid"></div>
  </div>

  <!-- TAB: ACTIVITEITEN -->
  <div class="tab-panel" id="tab-activiteiten">
    <div class="search-bar">
      <span class="search-icon">üîç</span>
      <input type="text" id="search-input" placeholder="Zoek een activiteit..." oninput="filterActivities()">
    </div>
    <div class="filter-chips" id="filter-chips"></div>
    <div class="activities-grid" id="activities-grid"></div>
  </div>

</div>

<!-- MODAL: Add activity -->
<div class="modal-overlay" id="add-modal">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title">‚úèÔ∏è Activiteit toevoegen</div>

    <div class="form-group">
      <label class="form-label">Tijdblok</label>
      <select class="form-select" id="modal-block">
        <option value="ochtend">üåÖ Ochtend</option>
        <option value="middag">‚òÄÔ∏è Middag</option>
        <option value="avond">üåô Avond</option>
      </select>
    </div>

    <div class="form-group">
      <label class="form-label">Dag</label>
      <select class="form-select" id="modal-day"></select>
    </div>

    <div class="form-group">
      <label class="form-label">Kies uit bibliotheek</label>
      <div class="library-pills" id="modal-library-pills"></div>
    </div>

    <div class="form-group">
      <label class="form-label">Of typ zelf</label>
      <input type="text" class="form-input" id="modal-custom-input" placeholder="bijv. üéà Ballonnen opblazen">
    </div>

    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeModal('add-modal')">Annuleren</button>
      <button class="btn btn-primary" onclick="saveActivity()">üíæ Opslaan</button>
    </div>
  </div>
</div>

<!-- MODAL: Plan from library -->
<div class="modal-overlay" id="plan-modal">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title" id="plan-modal-title">üìÖ Inplannen</div>

    <div class="form-group">
      <label class="form-label">Dag</label>
      <select class="form-select" id="plan-day"></select>
    </div>

    <div class="form-group">
      <label class="form-label">Tijdblok</label>
      <select class="form-select" id="plan-block">
        <option value="ochtend">üåÖ Ochtend</option>
        <option value="middag">‚òÄÔ∏è Middag</option>
        <option value="avond">üåô Avond</option>
      </select>
    </div>

    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeModal('plan-modal')">Annuleren</button>
      <button class="btn btn-primary" onclick="savePlan()">üìÖ Inplannen</button>
    </div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
// ==================== DATA ====================
var STORAGE_KEY = 'peuterplannen_data';

function loadData() {
  try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}; }
  catch(e) { return {}; }
}

function saveData(data) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

function dateKey(date) {
  var d = new Date(date);
  return d.getFullYear() + '-' + String(d.getMonth()+1).padStart(2,'0') + '-' + String(d.getDate()).padStart(2,'0');
}

function getActivitiesFor(dateStr, block) {
  var data = loadData();
  return (data[dateStr] && data[dateStr][block]) ? data[dateStr][block] : [];
}

function addActivityTo(dateStr, block, name) {
  var data = loadData();
  if (!data[dateStr]) data[dateStr] = {};
  if (!data[dateStr][block]) data[dateStr][block] = [];
  data[dateStr][block].push(name);
  saveData(data);
}

function removeActivityFrom(dateStr, block, index) {
  var data = loadData();
  if (data[dateStr] && data[dateStr][block]) {
    data[dateStr][block].splice(index, 1);
    saveData(data);
  }
}

// ==================== STATE ====================
var currentDate = new Date();
var weekOffset = 0;
var planActivityName = '';
var addModalBlock = 'ochtend';
var selectedLibraryPill = '';

// ==================== TABS ====================
function switchTab(name) {
  document.querySelectorAll('.tab-panel').forEach(function(p) { p.classList.remove('active'); });
  document.querySelectorAll('.tab-btn').forEach(function(b) { b.classList.remove('active'); });
  document.getElementById('tab-' + name).classList.add('active');
  var tabMap = { vandaag: 0, week: 1, activiteiten: 2 };
  var btns = document.querySelectorAll('.tab-btn');
  if (btns[tabMap[name]]) btns[tabMap[name]].classList.add('active');
  if (name === 'vandaag') renderToday(currentDate);
  if (name === 'week') renderWeek();
  if (name === 'activiteiten') renderActivities();
}

// ==================== TODAY ====================
var DAYS_NL = ['zondag','maandag','dinsdag','woensdag','donderdag','vrijdag','zaterdag'];
var MONTHS_NL = ['januari','februari','maart','april','mei','juni','juli','augustus','september','oktober','november','december'];

function renderToday(dateOverride) {
  var d = dateOverride || currentDate;
  var key = dateKey(d);
  document.getElementById('today-title').textContent =
    'Vandaag, ' + DAYS_NL[d.getDay()] + ' ' + d.getDate() + ' ' + MONTHS_NL[d.getMonth()];
  document.getElementById('today-badge').textContent = d.getDate() + ' ' + MONTHS_NL[d.getMonth()];

  ['ochtend','middag','avond'].forEach(function(block) {
    var list = document.getElementById('list-' + block);
    var items = getActivitiesFor(key, block);
    list.innerHTML = '';
    if (items.length === 0) {
      var empty = document.createElement('span');
      empty.className = 'empty-state';
      empty.textContent = 'Nog niets gepland... voeg iets toe! üåà';
      list.appendChild(empty);
    } else {
      items.forEach(function(name, i) {
        var pill = document.createElement('span');
        pill.className = 'activity-pill';
        pill.innerHTML = name + ' <button class="remove-btn" data-date="' + key + '" data-block="' + block + '" data-idx="' + i + '" title="Verwijder">\u00d7</button>';
        list.appendChild(pill);
      });
    }
  });

  // Attach remove listeners
  document.querySelectorAll('.remove-btn').forEach(function(btn) {
    btn.addEventListener('click', function() {
      removeActivity(this.dataset.date, this.dataset.block, parseInt(this.dataset.idx));
    });
  });
}

function removeActivity(dateStr, block, index) {
  removeActivityFrom(dateStr, block, index);
  renderToday(currentDate);
  showToast('Activiteit verwijderd üóëÔ∏è');
}

// ==================== WEEK ====================
var DAYS_SHORT = ['Zo','Ma','Di','Wo','Do','Vr','Za'];

function getWeekStart(offset) {
  var d = new Date();
  var day = d.getDay();
  var diff = (day === 0) ? -6 : 1 - day;
  d.setDate(d.getDate() + diff + offset * 7);
  d.setHours(0,0,0,0);
  return d;
}

function renderWeek() {
  var weekStart = getWeekStart(weekOffset);
  var weekEnd = new Date(weekStart);
  weekEnd.setDate(weekEnd.getDate() + 6);

  function fmt(d) { return d.getDate() + ' ' + MONTHS_NL[d.getMonth()].slice(0,3); }
  document.getElementById('week-label').textContent = fmt(weekStart) + ' \u2013 ' + fmt(weekEnd);

  var grid = document.getElementById('week-grid');
  grid.innerHTML = '';
  var todayKey = dateKey(new Date());

  for (var i = 0; i < 7; i++) {
    var day = new Date(weekStart);
    day.setDate(weekStart.getDate() + i);
    var key = dateKey(day);
    var isToday = key === todayKey;

    var card = document.createElement('div');
    card.className = 'day-card' + (isToday ? ' today' : '');
    card.setAttribute('data-date', key);

    // Mon=i+1 index wrapping
    var dayIdx = (i + 1) % 7;
    card.innerHTML = '<div class="day-name">' + DAYS_SHORT[dayIdx] + '</div><div class="day-num">' + day.getDate() + '</div>';

    var data = loadData();
    var dayData = data[key] || {};
    ['ochtend','middag','avond'].forEach(function(block) {
      var items = dayData[block] || [];
      items.slice(0,2).forEach(function(name) {
        var chip = document.createElement('div');
        chip.className = 'day-chip';
        chip.textContent = name.length > 10 ? name.slice(0,9) + '\u2026' : name;
        card.appendChild(chip);
      });
      if (items.length > 2) {
        var more = document.createElement('div');
        more.className = 'day-chip';
        more.textContent = '+' + (items.length - 2) + ' meer';
        card.appendChild(more);
      }
    });

    (function(capturedDay) {
      card.addEventListener('click', function() { goToDay(capturedDay); });
    })(new Date(day));

    grid.appendChild(card);
  }
}

function changeWeek(dir) {
  weekOffset += dir;
  renderWeek();
}

function goToDay(date) {
  currentDate = new Date(date);
  weekOffset = 0;
  switchTab('vandaag');
}

// ==================== ACTIVITIES LIBRARY ====================
var ACTIVITIES = [
  { emoji:'üõù', name:'Naar de speeltuin', cat:'buiten', age:'1-5 jaar', desc:'Klimmen, glijden en schommelen in de buitenlucht.' },
  { emoji:'üö≤', name:'Fietsen / loopfiets', cat:'buiten', age:'1-4 jaar', desc:'Buiten rijden op eigen tempo, lekker in beweging.' },
  { emoji:'üñçÔ∏è', name:'Tekenen met krijtjes', cat:'buiten', age:'2-5 jaar', desc:'Kleurrijke tekeningen maken op stoep of terras.' },
  { emoji:'üçÇ', name:'Bladeren verzamelen', cat:'buiten', age:'2-5 jaar', desc:'Op ontdekking in de natuur, kleuren en vormen zoeken.' },
  { emoji:'üèñÔ∏è', name:'Zandkasteel bouwen', cat:'buiten', age:'1-5 jaar', desc:'Fantasievolle bouwwerken in zandbak of op strand.' },
  { emoji:'üí¶', name:'Waterspelen in tuin', cat:'buiten', age:'1-4 jaar', desc:'Spatten, gieten en nat worden op warme dagen.' },
  { emoji:'üé®', name:'Vingerverven', cat:'creatief', age:'1-4 jaar', desc:'Schilderen met handjes en vingers ‚Äî lekker vies!' },
  { emoji:'ü™®', name:'Klei kneden', cat:'creatief', age:'2-5 jaar', desc:'Boetseren en vormen maken met zachte klei.' },
  { emoji:'üîñ', name:'Stempelen', cat:'creatief', age:'2-5 jaar', desc:'Vrolijke prints maken met stempels en verf.' },
  { emoji:'‚úÇÔ∏è', name:'Knutselen met papier', cat:'creatief', age:'3-5 jaar', desc:'Knippen, plakken en vouwen van papier en karton.' },
  { emoji:'ü•Å', name:'Muziek met pannen', cat:'creatief', age:'1-3 jaar', desc:'Eigen muziek maken met keukengerei als instrument.' },
  { emoji:'üìñ', name:'Voorlezen', cat:'rustig', age:'0-5 jaar', desc:'Samen in een boek kruipen en verhalen beleven.' },
  { emoji:'üß©', name:'Puzzelen', cat:'rustig', age:'2-5 jaar', desc:'Concentreren en puzzelstukjes op hun plek leggen.' },
  { emoji:'üÉè', name:'Memory spelen', cat:'rustig', age:'3-5 jaar', desc:'Geheugen trainen met kaartjes omdraaien en onthouden.' },
  { emoji:'üéµ', name:'Rustige muziek', cat:'rustig', age:'0-5 jaar', desc:'Ontspannen luisteren naar zachte kinderliedjes.' },
  { emoji:'üñºÔ∏è', name:'Beeldboeken bekijken', cat:'rustig', age:'1-4 jaar', desc:'Zelf plaatjes bekijken en verhaal bedenken.' },
  { emoji:'üëß', name:'Speeldate', cat:'sociaal', age:'2-5 jaar', desc:'Samen spelen met een vriendje of vriendinnetje.' },
  { emoji:'üìö', name:'Naar de bibliotheek', cat:'sociaal', age:'1-5 jaar', desc:'Boeken lenen en voorleesuurtje bijwonen.' },
  { emoji:'ü§∏', name:'Gymles peuters', cat:'sociaal', age:'2-4 jaar', desc:'Bewegen en spelen met andere peuters in de gymzaal.' },
  { emoji:'üõí', name:'Boodschappen doen', cat:'sociaal', age:'1-5 jaar', desc:'Meehelpen met boodschappen doen ‚Äî leren en ontdekken.' },
  { emoji:'üíÉ', name:'Dansen op muziek', cat:'bewegen', age:'1-5 jaar', desc:'Vrolijk bewegen en dansen op vrolijke nummers.' },
  { emoji:'üèóÔ∏è', name:'Hindernisbaan bouwen', cat:'bewegen', age:'2-5 jaar', desc:'Kussens, stoelen en dekens worden een avonturenparcours.' },
  { emoji:'ü§æ', name:'Trampolinespringen', cat:'bewegen', age:'2-5 jaar', desc:'Energie kwijt met springen op trampoline.' },
  { emoji:'‚öΩ', name:'Balspelen', cat:'bewegen', age:'1-5 jaar', desc:'Gooien, vangen, rollen ‚Äî grove motoriek ontwikkelen.' }
];

var FILTERS = [
  { key:'alle', label:'‚≠ê Alle' },
  { key:'buiten', label:'üå≥ Buiten' },
  { key:'creatief', label:'üé® Creatief' },
  { key:'rustig', label:'üò¥ Rustig' },
  { key:'sociaal', label:'üë´ Sociaal' },
  { key:'bewegen', label:'üèÉ Bewegen' }
];

var activeFilter = 'alle';

function renderFilterChips() {
  var container = document.getElementById('filter-chips');
  container.innerHTML = '';
  FILTERS.forEach(function(f) {
    var chip = document.createElement('button');
    chip.className = 'filter-chip' + (activeFilter === f.key ? ' active' : '');
    chip.textContent = f.label;
    (function(fkey) {
      chip.addEventListener('click', function() { activeFilter = fkey; renderActivities(); });
    })(f.key);
    container.appendChild(chip);
  });
}

function renderActivities() {
  renderFilterChips();
  var query = (document.getElementById('search-input').value || '').toLowerCase();
  var grid = document.getElementById('activities-grid');
  grid.innerHTML = '';

  var filtered = ACTIVITIES.filter(function(a) {
    var matchCat = activeFilter === 'alle' || a.cat === activeFilter;
    var matchSearch = !query || a.name.toLowerCase().indexOf(query) !== -1 || a.desc.toLowerCase().indexOf(query) !== -1;
    return matchCat && matchSearch;
  });

  if (filtered.length === 0) {
    var noRes = document.createElement('div');
    noRes.className = 'no-results';
    noRes.style.gridColumn = '1 / -1';
    noRes.innerHTML = '<div class="nr-emoji">üîç</div><p>Geen activiteiten gevonden.<br>Probeer een andere zoekterm!</p>';
    grid.appendChild(noRes);
    return;
  }

  filtered.forEach(function(a) {
    var card = document.createElement('div');
    card.className = 'activity-card';
    var planName = (a.emoji + ' ' + a.name).replace(/'/g, "\\'");
    card.innerHTML =
      '<div class="activity-emoji">' + a.emoji + '</div>' +
      '<div class="activity-name">' + a.name + '</div>' +
      '<span class="activity-age">üë∂ ' + a.age + '</span>' +
      '<div class="activity-desc">' + a.desc + '</div>';
    var planBtn = document.createElement('button');
    planBtn.className = 'btn btn-primary btn-sm';
    planBtn.textContent = 'üìÖ Inplannen';
    (function(aEmoji, aName) {
      planBtn.addEventListener('click', function() { openPlanModal(aEmoji + ' ' + aName); });
    })(a.emoji, a.name);
    card.appendChild(planBtn);
    grid.appendChild(card);
  });
}

function filterActivities() { renderActivities(); }

// ==================== MODALS ====================
function openAddModal(block) {
  addModalBlock = block;
  selectedLibraryPill = '';
  document.getElementById('modal-block').value = block;
  document.getElementById('modal-custom-input').value = '';
  populateDaySelect('modal-day');
  populateLibraryPills();
  openModal('add-modal');
}

function populateLibraryPills() {
  var container = document.getElementById('modal-library-pills');
  container.innerHTML = '';
  ACTIVITIES.slice(0, 12).forEach(function(a) {
    var pill = document.createElement('button');
    pill.className = 'library-pill';
    pill.textContent = a.emoji + ' ' + a.name;
    var fullName = a.emoji + ' ' + a.name;
    pill.addEventListener('click', function() {
      selectedLibraryPill = fullName;
      container.querySelectorAll('.library-pill').forEach(function(p) { p.classList.remove('selected'); });
      pill.classList.add('selected');
      document.getElementById('modal-custom-input').value = '';
    });
    container.appendChild(pill);
  });
}

function saveActivity() {
  var block = document.getElementById('modal-block').value;
  var dayVal = document.getElementById('modal-day').value;
  var custom = document.getElementById('modal-custom-input').value.trim();
  var name = custom || selectedLibraryPill;

  if (!name) { showToast('Kies of typ een activiteit! ‚úèÔ∏è'); return; }

  addActivityTo(dayVal, block, name);
  closeModal('add-modal');
  renderToday(currentDate);
  showToast('Activiteit toegevoegd! üéâ');
}

function openPlanModal(actName) {
  planActivityName = actName;
  document.getElementById('plan-modal-title').textContent = 'üìÖ ' + actName + ' inplannen';
  populateDaySelect('plan-day');
  openModal('plan-modal');
}

function savePlan() {
  var day = document.getElementById('plan-day').value;
  var block = document.getElementById('plan-block').value;
  addActivityTo(day, block, planActivityName);
  closeModal('plan-modal');
  showToast('Ingepland! üìÖ');
}

function populateDaySelect(selectId) {
  var sel = document.getElementById(selectId);
  sel.innerHTML = '';
  var today = new Date();
  today.setHours(0,0,0,0);
  for (var i = 0; i < 14; i++) {
    var d = new Date(today);
    d.setDate(today.getDate() + i);
    var opt = document.createElement('option');
    opt.value = dateKey(d);
    var label = i === 0 ? 'Vandaag' : i === 1 ? 'Morgen' : DAYS_NL[d.getDay()] + ' ' + d.getDate() + ' ' + MONTHS_NL[d.getMonth()];
    opt.textContent = label;
    sel.appendChild(opt);
  }
}

function openModal(id) {
  document.getElementById(id).classList.add('open');
}

function closeModal(id) {
  document.getElementById(id).classList.remove('open');
}

// Close modal on overlay click
document.querySelectorAll('.modal-overlay').forEach(function(overlay) {
  overlay.addEventListener('click', function(e) {
    if (e.target === overlay) closeModal(overlay.id);
  });
});

// ==================== TOAST ====================
var toastTimer;
function showToast(msg) {
  var t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(function() { t.classList.remove('show'); }, 2500);
}

// ==================== INIT ====================
renderToday(currentDate);
renderActivities();
</script>
</body>
</html>
